<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<title>TODO LIST</title>
		<meta name="description" content="">
		<meta name="author" content="mjchoi">
		<style>
			html, * { margin:0; padding:0; }
			ul, ol, li, dl, dd, dt { list-style:none; }

		</style>
	</head>
	<body>
		<h1>TODO LIST</h1>
		<section>
			<div>
				<input type="text" id="dataValue">
				<button onclick="TODO.add(document.getElementById('dataValue').value)">등록하기</button>
			</div>
			<dl id="dataList"></dl>
			<p id="notice"></p>
		</section>

<script>
const TODO = (function() {
	let MODE = "html";
	const DATA = [];
	const STATE = ["예정", "진행", "완료"];

	// idx 체크
	const checkIdx = idx => {
		let validIdx = false;
		DATA.forEach(function(v, i) {
			if ( DATA[i].idx === idx ) validIdx = true;
		})
		if ( !validIdx || idx < 0 || ( typeof idx !== "number" && isNaN(idx) ) ) warning("잘못된 idx 값");
	};

	const warning = msg => {
		if ( MODE === "html") {
			const printBox = document.getElementById("notice");
			printBox.value = msg;
		} else {
			console.log(msg);
		}
		return;
	}

	// 데이터 추가
	const addData = (() => {
		let idx = 0;
		return value => {
			if (!value) throw "내용 입력하기!";
			DATA.push({
				idx : idx++,
				state : STATE[0],
				value : value
			});

			render();
		}
	})();

	// 데이터 삭제
	const removeData = function(idx) {
		checkIdx(idx);
		if (DATA.length <= 0) return false;

		DATA.forEach(function(v, i) {
			if ( DATA[i].idx === idx ) DATA.splice(i, 1);
			// break;
		})

		render();
	};

	// 데이터 수정
	const editData = idx => {
		let inputData = {
			idx : null,
			state : null,
			// value : null
		}
		let stateIdx = 0;
		checkIdx(idx);
		inputData.idx = idx;

		// 변경될 state 설정
		DATA.filter(function(obj, i){
			if (obj.idx === inputData.idx) {
				STATE.forEach((state, i) => {
					if (state === obj.state) stateIdx = ++i;
				})
				if ( stateIdx === STATE.length ) stateIdx = 0;
				inputData.state = STATE[stateIdx];
			}
		});

		if ( inputData.idx >= 0 && inputData.state ) {
			DATA.filter(function(obj, i){
				if ( obj.idx === inputData.idx ) {
					obj.state = inputData.state;
				}
			})
		} else {
			warning("state 누락");
		}

		render();
	};

	const render = (function() {
		const renderHtml = () => {
			const element = document.getElementById("dataList");
			const inputBox = document.getElementById('dataValue');
			let addDataList = "<dt><span class='index'>번호</span>내용<span class='state'>진행상황</span><span class='remove'>삭제</span></dt>";
			if ( DATA.length > 0 ) {
				DATA.forEach( v => {
					addDataList += `<dd><span class="index">${v.idx}</span> ${v.value} <button class="state" onclick="TODO.edit(${v.idx})">${v.state}</button><button class="remove" onclick="TODO.remove(${v.idx})">삭제</button></dd>`;
				})
			}
			element.innerHTML = addDataList;
			inputBox.value = "";
		};

		const renderConsole = () => {
			if ( DATA.length > 0 ) DATA.forEach( v => { console.log(v); });
		};

		return () => {
			if ( MODE === "html") {
				renderHtml();
			} else {
				renderConsole();
			}
		}
	})();

	render();

	return {
		add : addData,
		edit : editData,
		remove : removeData,
		setMode : function(mode) {
			MODE = mode;
		}
	}
})();
</script>
	</body>
</html>
